<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GiftGenius.ai - Find the Perfect Gift</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8F9FA;
        }
        .step {
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }
        .step.hidden {
            opacity: 0;
            transform: translateY(20px);
            position: absolute;
            pointer-events: none;
        }
        .step.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .loader {
            border-top-color: #14B8A6; /* Teal */
            animation: spinner 1.5s linear infinite;
        }
        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .budget-option.selected {
            border-color: #0D9488; /* Darker Teal */
            background-color: #F0FDFA; /* Light Teal */
            color: #115E59;
        }
        .persona-checkbox:checked + label {
            border-color: #14B8A6;
            background-color: #F0FDFA;
        }
        html {
            scroll-behavior: smooth;
        }
        .progress-bar-fill {
            transition: width 0.5s ease-out;
        }
        .scroll-container {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        .scroll-container::-webkit-scrollbar {
            display: none; /* Chrome, Safari and Opera */
        }
        .modal {
            transition: opacity 0.3s ease;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-20">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="text-2xl font-bold text-gray-900 cursor-pointer" onclick="showMainView()">GiftGenius<span class="text-teal-600">.ai</span></div>
            <div id="auth-container" class="flex items-center gap-4">
                <!-- Logged Out State -->
                <div id="logged-out-view">
                    <button onclick="openAuthModal('login')" class="font-bold text-gray-600 hover:text-teal-600 transition">Log In</button>
                    <button onclick="openAuthModal('signup')" class="bg-teal-600 text-white font-bold py-2 px-5 rounded-lg hover:bg-teal-700 transition">Sign Up</button>
                </div>
                <!-- Logged In State -->
                <div id="logged-in-view" class="hidden">
                     <span id="userEmail" class="text-sm text-gray-500 hidden sm:block"></span>
                     <button onclick="showDashboard()" class="font-bold text-gray-600 hover:text-teal-600 transition">Dashboard</button>
                     <button onclick="logoutUser()" class="bg-gray-200 text-gray-700 font-bold py-2 px-5 rounded-lg hover:bg-gray-300 transition">Log Out</button>
                </div>
            </div>
        </nav>
    </header>

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <div id="main-content">
            <!-- Hero Section and Tool... -->
            <section class="text-center my-12 sm:my-20">
                 <h1 class="text-4xl sm:text-6xl font-extrabold text-gray-900 leading-tight">
                    Stop Guessing. <br class="hidden sm:block">
                    Find the <span class="text-teal-600">Perfect Thoughtful Gift</span> in Seconds.
                </h1>
                <p class="mt-4 max-w-2xl mx-auto text-lg text-gray-600">
                    Our AI personal shopper analyzes your loved one's unique personality to suggest gifts they'll actually cherish. No more generic mugs or blankets.
                </p>
                <a href="#toolContainer" class="mt-8 inline-block bg-yellow-500 text-gray-900 font-bold py-4 px-8 rounded-lg text-lg hover:bg-yellow-600 transition duration-150">
                    Start Your Free Search
                </a>
            </section>
            <main id="toolContainer" class="bg-white p-6 sm:p-8 rounded-2xl shadow-xl max-w-2xl mx-auto">
                <!-- Gift finder tool steps will be here -->
            </main>
            <section id="resultsSection" class="mt-16 hidden">
                <!-- Results will be shown here -->
            </section>
        </div>

        <!-- Dashboard Section (Hidden by default) -->
        <div id="dashboard-view" class="hidden">
            <h2 class="text-3xl font-bold text-gray-900 mb-8">Your Dashboard</h2>
            
            <div class="bg-teal-50 border-2 border-teal-200 p-6 rounded-2xl mb-8 text-center">
                <h3 class="text-2xl font-bold text-teal-800">Unlock Your Full Potential</h3>
                <p class="text-teal-700 mt-2">Upgrade to GiftGenius Pro to save profiles, get unlimited searches, and set occasion reminders.</p>
                <button class="mt-4 bg-teal-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-teal-700 transition">Upgrade to Pro ($9/month)</button>
            </div>

            <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-xl mb-8">
                <h3 class="text-2xl font-semibold text-gray-800 mb-6">Saved Profiles</h3>
                <div id="profilesList" class="space-y-4">
                    <!-- Profiles from Firestore will be injected here -->
                    <p class="text-gray-500">You haven't saved any profiles yet.</p>
                </div>
                <button onclick="openProfileModal()" class="mt-6 w-full bg-gray-200 text-gray-700 font-bold py-3 rounded-lg hover:bg-gray-300 transition">Add New Profile</button>
            </div>

            <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-xl">
                <h3 class="text-2xl font-semibold text-gray-800 mb-6">Occasion Reminders</h3>
                 <div id="remindersList" class="space-y-4">
                    <p class="text-gray-500">You haven't set any reminders yet.</p>
                 </div>
                <button class="mt-6 w-full bg-gray-200 text-gray-700 font-bold py-3 rounded-lg hover:bg-gray-300 transition">Add New Reminder</button>
            </div>
        </div>
    </div>
    
    <!-- Auth Modal -->
    <div id="authModal" class="modal fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-30 hidden opacity-0">
        <!-- Auth modal content... -->
    </div>
    
    <!-- Add Profile Modal -->
    <div id="profileModal" class="modal fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-30 hidden opacity-0">
        <div class="bg-white rounded-2xl shadow-xl p-8 max-w-md w-full relative">
            <button onclick="closeProfileModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">&times;</button>
            <h2 class="text-2xl font-bold mb-4">Add a New Profile</h2>
            <p class="text-gray-600 mb-6">Save details about your loved ones for faster, more personalized gift searches in the future.</p>
            <div class="space-y-4">
                <input type="text" id="profileName" placeholder="Profile Name (e.g., Dad, Jane)" class="w-full p-3 border border-gray-300 rounded-lg">
                <textarea id="profileDetails" rows="4" placeholder="Their interests, hobbies, and personality (e.g., Loves gardening, old music, and movies. Fan of classic rock.)" class="w-full p-3 border border-gray-300 rounded-lg"></textarea>
                <button onclick="saveProfile()" class="w-full bg-teal-600 text-white font-bold py-3 rounded-lg hover:bg-teal-700">Save Profile</button>
            </div>
            <p id="profileError" class="text-red-500 text-sm mt-4"></p>
        </div>
    </div>


    <!-- Firebase SDKs -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            GoogleAuthProvider,
            signInWithPopup,
            signOut
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import {
            getFirestore,
            collection,
            addDoc,
            query,
            where,
            onSnapshot
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCW0JGmWx9Jktu0g33DcRz9CdgXblkmm-4",
            authDomain: "giftagent-3c6a4.firebaseapp.com",
            projectId: "giftagent-3c6a4",
            storageBucket: "giftagent-3c6a4.appspot.com",
            messagingSenderId: "69511320242",
            appId: "1:69511320242:web:22a45257d8bacf4aa2efab",
            measurementId: "G-XW6QWBDYPX"
        };

        // Initialize Firebase
        let app;
        let auth;
        let db;
        let googleProvider;
        let profilesUnsubscribe = null; // To detach listener on logout

        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            googleProvider = new GoogleAuthProvider();
        } catch (error) {
            console.error("Firebase initialization failed.", error);
        }

        // --- AUTH UI MANAGEMENT ---
        const authModal = document.getElementById('authModal');
        const loggedInView = document.getElementById('logged-in-view');
        const loggedOutView = document.getElementById('logged-out-view');
        const userEmailEl = document.getElementById('userEmail');
        
        if (auth) {
            onAuthStateChanged(auth, user => {
                if (user) {
                    loggedInView.classList.remove('hidden');
                    loggedOutView.classList.add('hidden');
                    userEmailEl.textContent = user.email;
                    closeAuthModal();
                    showDashboard();
                    fetchProfiles(user.uid); // Fetch profiles when user logs in
                } else {
                    loggedInView.classList.add('hidden');
                    loggedOutView.classList.remove('hidden');
                    userEmailEl.textContent = '';
                    showMainView();
                    if (profilesUnsubscribe) {
                        profilesUnsubscribe(); // Detach the listener
                    }
                }
            });
        }
        
        // --- AUTH FUNCTIONS (abbreviated for clarity) ---
        window.openAuthModal = (view) => { /* ... */ };
        window.closeAuthModal = () => { /* ... */ };
        window.signupUser = () => { /* ... */ };
        window.loginUser = () => { /* ... */ };
        window.signInWithGoogle = () => { /* ... */ };
        window.logoutUser = () => { if (auth) signOut(auth); };

        // --- VIEW MANAGEMENT ---
        const mainContent = document.getElementById('main-content');
        const dashboardView = document.getElementById('dashboard-view');

        window.showDashboard = () => {
            mainContent.classList.add('hidden');
            dashboardView.classList.remove('hidden');
        }

        window.showMainView = () => {
            mainContent.classList.remove('hidden');
            dashboardView.classList.add('hidden');
        }

        // --- FIRESTORE DATABASE FUNCTIONS ---
        const profileModal = document.getElementById('profileModal');
        const profileErrorEl = document.getElementById('profileError');
        const profilesListEl = document.getElementById('profilesList');

        window.openProfileModal = () => {
            profileErrorEl.textContent = '';
            document.getElementById('profileName').value = '';
            document.getElementById('profileDetails').value = '';
            profileModal.classList.remove('hidden');
            setTimeout(() => profileModal.classList.remove('opacity-0'), 10);
        }

        window.closeProfileModal = () => {
            profileModal.classList.add('opacity-0');
            setTimeout(() => profileModal.classList.add('hidden'), 300);
        }

        window.saveProfile = async () => {
            const user = auth.currentUser;
            if (!user) {
                profileErrorEl.textContent = "You must be logged in to save profiles.";
                return;
            }

            const name = document.getElementById('profileName').value.trim();
            const details = document.getElementById('profileDetails').value.trim();

            if (!name || !details) {
                profileErrorEl.textContent = "Please fill out both fields.";
                return;
            }

            try {
                const docRef = await addDoc(collection(db, "profiles"), {
                    userId: user.uid,
                    name: name,
                    details: details,
                    createdAt: new Date()
                });
                console.log("Profile saved with ID: ", docRef.id);
                closeProfileModal();
            } catch (e) {
                console.error("Error adding document: ", e);
                profileErrorEl.textContent = "Could not save profile. Please try again.";
            }
        }

        function fetchProfiles(userId) {
            const q = query(collection(db, "profiles"), where("userId", "==", userId));
            
            // onSnapshot listens for real-time updates
            profilesUnsubscribe = onSnapshot(q, (querySnapshot) => {
                const profiles = [];
                querySnapshot.forEach((doc) => {
                    profiles.push({ id: doc.id, ...doc.data() });
                });
                renderProfiles(profiles);
            });
        }

        function renderProfiles(profiles) {
            profilesListEl.innerHTML = ''; // Clear the list
            if (profiles.length === 0) {
                profilesListEl.innerHTML = '<p class="text-gray-500">You haven\'t saved any profiles yet.</p>';
                return;
            }

            profiles.forEach(profile => {
                const profileEl = document.createElement('div');
                profileEl.className = 'flex items-center justify-between bg-gray-50 p-4 rounded-lg';
                profileEl.innerHTML = `
                    <div>
                        <p class="font-bold text-gray-800">${profile.name}</p>
                        <p class="text-sm text-gray-500 truncate max-w-xs">${profile.details}</p>
                    </div>
                    <button class="text-teal-600 hover:text-teal-800 font-semibold">Find Gift</button>
                `;
                profilesListEl.appendChild(profileEl);
            });
        }

    </script>
    
    <!-- Your existing app script for the gift generator tool goes here -->
    <script>
        // ...
    </script>

</body>
</html>
